{#

  A custom snippet for the dataset items on dataset listings. Unless
  templates, You currently can not extend snippets, so if you want to modify
  one of them you need to copy the entire file from CKAN core to your 
  extension and modify it.

#}
{% set truncate = truncate or 180 %}
{% set truncate_title = truncate_title or 80 %}
{% set title = package.title or package.name %}
{% set notes = h.markdown_extract(package.notes, extract_length=truncate) %}

<li class="{{ item_class or "dataset-item" }}">
  {% block package_item_content %}
    <div class="dataset-content">
      <h3 class="dataset-heading">
        {% if package.private %}
          <span class="dataset-private label label-inverse">
            <i class="icon-lock"></i>
            {{ _('Private') }}
          </span>
        {% endif %}
        {{ h.link_to(h.truncate(title, truncate_title), h.url_for(controller='package', action='read', id=package.name)) }}
        {% if package.get('state', '').startswith('draft') %}
          <span class="label label-info">{{ _('Draft') }}</span>
        {% elif package.get('state', '').startswith('deleted') %}
          <span class="label label-important">{{ _('Deleted') }}</span>
        {% endif %}
        {{ h.popular('recent views', package.tracking_summary.recent, min=10) if package.tracking_summary }}
      </h3>
      {% if banner %}
        <span class="banner">{{ _('Popular') }}</span>
      {% endif %}
      {% if notes %}
        <div>{{ notes|urlize }}</div>
      {% else %}
        <p class="empty">{{ _("This dataset has no description") }}</p>
      {% endif %}

      <!-- These are our customizations. You can access all fields of the
          dataset (package), and the helper function present on `h` -->


      <div><em>Last modified:</em> {{ h.time_ago_in_words_from_str(package.metadata_modified, granularity='minute') }} ago</div>
      <div><em>No. of resources:</em> {{ package.num_resources }}</div>


      <!-- End of customizations -->

    </div>
    {% if package.resources and not hide_resources %}
      <ul class="dataset-resources unstyled">
        {% for resource in h.dict_list_reduce(package.resources, 'format') %}
          <li>
            <a href="{{ h.url_for(controller='package', action='read', id=package.name) }}" class="label" data-format="{{ resource.lower() }}">{{ resource }}</a>
          </li>
        {% endfor %}
      </ul>
    {% endif %}
  {% endblock %}
</li>
